# This script transforms all categorical variables into factors
# with labels extracted from the dictionary tables. It also converts all
# date variables from char to date.

# While the factor conversion procedure could be easily made through a for loop,
# not all dictionaries where present in the dataset, and the id and label variables where
# not always consistently named. Therefore the script was first generated by the perl script ...
# and all commands where manually edited when needed.

# clearing workspace
rm(list=ls())

path = "~/Collusion/COMPRASNET/R_original"
newpath = "~/Collusion/COMPRASNET/R_new" # Different path to avoid overrides


convert_to_date <- function(var){
#Small auxiliary function that converts all "DT*" columns in a data frame to date type
    datevars = grep('^DT',names(var), value=TRUE)
    for (x in datevars) {
        print(x)
        var[[x]] <- as.Date(var[[x]], format = "%Y-%m-%d")
    }
    return(var)
}

## first load the dictionaries

load(paste0(path,"/dicionarios.rdata"))

## D_ITCP_PLACA_INDICADORES

D_ITCP_PLACA_INDICADORES$DS_ITCP_IN_EXIST_CONTRATO  <- 
  factor(D_ITCP_PLACA_INDICADORES$ID_ITCP_IN_EXIST_CONTRATO,
         levels = D_ITCP_IN_EXIST_CONTRATO$ID_ITCP_IN_EXIST_CONTRATO,
         labels = D_ITCP_IN_EXIST_CONTRATO$DS_ITCP_IN_EXIST_CONTRATO)

D_ITCP_PLACA_INDICADORES$DS_ITCP_IN_RENEG_ITEM_SRP  <-
  factor(D_ITCP_PLACA_INDICADORES$ID_ITCP_IN_RENEG_ITEM_SRP,
         levels = D_ITCP_IN_RENEG_ITEM_SRP$ID_ITCP_IN_RENEG_ITEM_SRP,
         labels = D_ITCP_IN_RENEG_ITEM_SRP$DS_ITCP_IN_RENEG_ITEM_SRP)

D_ITCP_PLACA_INDICADORES$DS_ITCP_IN_ITEM_SEMEL_UASG  <-
  factor(D_ITCP_PLACA_INDICADORES$ID_ITCP_IN_ITEM_SEMEL_UASG,
         levels = D_ITCP_IN_ITEM_SEMEL_UASG$ID_ITCP_IN_ITEM_SEMEL_UASG,
         labels = D_ITCP_IN_ITEM_SEMEL_UASG$DS_ITCP_IN_ITEM_SEMEL_UASG)

D_ITCP_PLACA_INDICADORES$DS_ITCP_IN_COTACAO_ELETR  <-
  factor(D_ITCP_PLACA_INDICADORES$ID_ITCP_IN_COTACAO_ELETR,
         levels = D_ITCP_IN_COTACAO_ELETR$ID_ITCP_IN_COTACAO_ELETR,
         labels = D_ITCP_IN_COTACAO_ELETR$DS_ITCP_IN_COTACAO_ELETR)

D_ITCP_PLACA_INDICADORES$DS_ITCP_TP_BENEF_ME_EPP  <-
  factor(D_ITCP_PLACA_INDICADORES$ID_ITCP_TP_BENEF_ME_EPP,
         levels = D_ITCP_TP_BENEF_ME_EPP$ID_ITCP_TP_BENEF_ME_EPP,
         labels = D_ITCP_TP_BENEF_ME_EPP$DS_ITCP_TP_BENEF_ME_EPP)

##  D_ITFN_PLACA_INDICADORES

D_ITFN_PLACA_INDICADORES$DS_ITFN_IN_FORNEC_ACEITO  <-
  factor(D_ITFN_PLACA_INDICADORES$ID_ITFN_IN_FORNEC_ACEITO,
         levels = D_ITFN_IN_FORNEC_ACEITO$ID_ITFN_IN_FORNEC_ACEITO,
         labels = D_ITFN_IN_FORNEC_ACEITO$DS_ITFN_IN_FORNEC_ACEITO)

D_ITFN_PLACA_INDICADORES$DS_ITFN_IN_FORNEC_HABILITADO  <-
  factor(D_ITFN_PLACA_INDICADORES$ID_ITFN_IN_FORNEC_HABILITADO,
         levels = D_ITFN_IN_FORNEC_HABILITADO$ID_ITFN_IN_FORNEC_HABILITADO,
         labels = D_ITFN_IN_FORNEC_HABILITADO$DS_ITFN_IN_FORNEC_HABILITADO)

D_ITFN_PLACA_INDICADORES$DS_ITFN_IN_FORNEC_SOCIO_COMPRA  <-
  factor(D_ITFN_PLACA_INDICADORES$ID_ITFN_IN_FORNEC_SOCIO_COMPRA,
         levels = D_ITFN_IN_FORNEC_SOCIO_COMPRA$ID_ITFN_IN_FORNEC_SOCIO_COMPRA,
         labels = D_ITFN_IN_FORNEC_SOCIO_COMPRA$DS_ITFN_IN_FORNEC_SOCIO_COMPRA)

D_ITFN_PLACA_INDICADORES$DS_ITFN_IN_REPRES_FORNEC  <-
  factor(D_ITFN_PLACA_INDICADORES$ID_ITFN_IN_REPRES_FORNEC,
         levels = D_ITFN_IN_REPRES_FORNEC$ID_ITFN_IN_REPRES_FORNEC,
         labels = D_ITFN_IN_REPRES_FORNEC$DS_ITFN_IN_REPRES_FORNEC)

D_ITFN_PLACA_INDICADORES$ID_VAGO1  <-  NULL

## D_ITCP_CLASSE_MAT_SERV

D_ITCP_CLASSE_MAT_SERV$DS_ITCP_GRUPO_MATERIAL  <-
  factor(D_ITCP_CLASSE_MAT_SERV$ID_ITCP_GRUPO_MATERIAL,
         levels = D_ITCP_GRUPO_MATERIAL$ID_ITCP_GRUPO_MATERIAL,
         labels = D_ITCP_GRUPO_MATERIAL$DS_ITCP_GRUPO_MATERIAL)

D_ITCP_CLASSE_MAT_SERV$DS_ITCP_GRUPO_SERVICO  <-
  factor(D_ITCP_CLASSE_MAT_SERV$ID_ITCP_GRUPO_SERVICO,
         levels = D_ITCP_GRUPO_SERVICO$ID_ITCP_GRUPO_SERVICO,
         labels = D_ITCP_GRUPO_SERVICO$DS_ITCP_GRUPO_SERVICO)

# D_LCAL_MUNICIPIO

D_LCAL_MUNICIPIO$DS_LCAL_UF  <-
  factor(D_LCAL_MUNICIPIO$ID_LCAL_UF, levels = D_LCAL_UF$ID_LCAL_UF,
         labels = D_LCAL_UF$DS_LCAL_UF)

D_LCAL_MUNICIPIO$DS_LCAL_REGIAO  <- factor(D_LCAL_MUNICIPIO$ID_LCAL_REGIAO,
                                           levels = D_LCAL_REGIAO$ID_LCAL_REGIAO,
                                           labels = D_LCAL_REGIAO$DS_LCAL_REGIAO)

save(file = paste0(newpath,"/dicionarios.rdata"), list = ls(pattern = '^D'))

## D_CMPR_COMPRA

D_CMPR_COMPRA <- readRDS(paste0(path,"/D_CMPR_COMPRA.rds"))
D_CMPR_COMPRA <- convert_to_date(D_CMPR_COMPRA) 

D_CMPR_COMPRA$DS_CMPR_FORMA_COMPRA  <-
  factor(D_CMPR_COMPRA$ID_CMPR_FORMA_COMPRA,
         levels = D_CMPR_FORMA_COMPRA$ID_CMPR_FORMA_COMPRA,
         labels = D_CMPR_FORMA_COMPRA$DS_CMPR_FORMA_COMPRA)

D_CMPR_COMPRA$DS_CMPR_MODALIDADE_COMPRA  <-
  factor(D_CMPR_COMPRA$ID_CMPR_MODALIDADE_COMPRA,
         levels = D_CMPR_MODALIDADE_COMPRA$ID_CMPR_MODALIDADE_COMPRA,
         labels = D_CMPR_MODALIDADE_COMPRA$DS_CMPR_MODALIDADE_COMPRA)

D_CMPR_COMPRA$DS_CMPR_TP_PREGAO  <-
  factor(D_CMPR_COMPRA$ID_CMPR_TP_PREGAO,
         levels = D_CMPR_TP_PREGAO$ID_CMPR_TP_PREGAO,
         labels = D_CMPR_TP_PREGAO$DS_CMPR_TP_PREGAO)

D_CMPR_COMPRA$DS_CMPR_INCISO_DISP_LEGAL <-
  factor(D_CMPR_COMPRA$ID_CMPR_INCISO_DISP_LEGAL,
         levels = D_CMPR_INCISO_DISP_LEGAL$ID_CMPR_INCISO_DISP_LEGAL,
         labels = D_CMPR_INCISO_DISP_LEGAL$DS_CMPR_INCISO_DISP_LEGAL)

D_CMPR_COMPRA$DS_CMPR_SIT_ATUAL_COMPRA  <-
  factor(D_CMPR_COMPRA$ID_CMPR_SIT_ATUAL_COMPRA,
         levels = D_CMPR_SIT_ATUAL_COMPRA$ID_CMPR_SIT_ATUAL_COMPRA,
         labels = D_CMPR_SIT_ATUAL_COMPRA$DS_CMPR_SIT_ATUAL_COMPRA)

D_CMPR_COMPRA$DS_CMPR_IN_SUBROG_COMPRA  <-
  factor(D_CMPR_COMPRA$ID_CMPR_IN_SUBROG_COMPRA,
         levels = D_CMPR_IN_SUBROG_COMPRA$ID_CMPR_IN_SUBROG_COMPRA,
         labels = D_CMPR_IN_SUBROG_COMPRA$DS_CMPR_IN_SUBROG_COMPRA)

D_CMPR_COMPRA$DS_CMPR_IN_RECUR_BID_BIRD  <-
  factor(D_CMPR_COMPRA$ID_CMPR_IN_RECUR_BID_BIRD,
         levels = D_CMPR_IN_RECUR_BID_BIRD$ID_CMPR_IN_RECUR_BID_BIRD,
         labels = D_CMPR_IN_RECUR_BID_BIRD$DS_CMPR_IN_RECUR_BID_BIRD)

D_CMPR_COMPRA$DS_CMPR_IN_EXIST_RESULT_COMPRA  <-
  factor(D_CMPR_COMPRA$ID_CMPR_IN_EXIST_RESULT_COMPRA,
         levels = D_CMPR_IN_EXIST_RESULT_COMPRA$ID_CMPR_IN_EXIST_RESULT_COMPRA,
         labels = D_CMPR_IN_EXIST_RESULT_COMPRA$DS_CMPR_IN_EXIST_RESULT_COMPRA)

D_CMPR_COMPRA$DS_CMPR_IN_UTILIZ_ICMS_COMPRA  <-
  factor(D_CMPR_COMPRA$ID_CMPR_IN_UTILIZ_ICMS_COMPRA,
         levels = D_CMPR_IN_UTILIZ_ICMS_COMPRA$ID_CMPR_IN_UTILIZ_ICMS_COMPRA,
         labels = D_CMPR_IN_UTILIZ_ICMS_COMPRA$DS_CMPR_IN_UTILIZ_ICMS_COMPRA)

D_CMPR_COMPRA$DS_CMPR_TP_LICITACAO  <-
  factor(D_CMPR_COMPRA$ID_CMPR_TP_LICITACAO,
         levels = D_CMPR_TP_LICITACAO$ID_CMPR_TP_LICITACAO,
         labels = D_CMPR_TP_LICITACAO$DS_CMPR_TP_LICITACAO)

D_CMPR_COMPRA$DS_CMPR_SIT_ATUAL_COMPRA  <-
  factor(D_CMPR_COMPRA$ID_CMPR_SIT_ATUAL_COMPRA,
         levels = D_CMPR_SIT_ATUAL_COMPRA$ID_CMPR_SIT_ATUAL_COMPRA,
         labels = D_CMPR_SIT_ATUAL_COMPRA$DS_CMPR_SIT_ATUAL_COMPRA)

D_CMPR_COMPRA$DS_CMPR_IN_COTACAO_ELETR  <-
  factor(D_CMPR_COMPRA$ID_CMPR_IN_COTACAO_ELETR,
         levels = D_CMPR_IN_COTACAO_ELETR$ID_CMPR_IN_COTACAO_ELETR,
         labels = D_CMPR_IN_COTACAO_ELETR$DS_CMPR_IN_COTACAO_ELETR)

saveRDS(D_CMPR_COMPRA,paste0(newpath,"/D_CMPR_COMPRA.rds"))

rm(D_CMPR_COMPRA)

# F_ITEM_COMPRA

F_ITEM_COMPRA <- readRDS(paste0(path,"/F_ITEM_COMPRA.rds")) 
F_ITEM_COMPRA <- convert_to_date(F_ITEM_COMPRA) 

F_ITEM_COMPRA$DS_ITCP_SIT_ATUAL_ITEM  <-
  factor(F_ITEM_COMPRA$ID_ITCP_SIT_ATUAL_ITEM,
         levels = D_ITCP_SIT_ATUAL_ITEM$ID_ITCP_SIT_ATUAL_ITEM,
         labels = D_ITCP_SIT_ATUAL_ITEM$DS_ITCP_SIT_ATUAL_ITEM)

F_ITEM_COMPRA  <- merge(F_ITEM_COMPRA,D_ITCP_PLACA_INDICADORES, by = "ID_ITCP_PLACA_INDICADORES")
                        
saveRDS(F_ITEM_COMPRA,paste0(newpath,"/F_ITEM_COMPRA.rds"))

rm(F_ITEM_COMPRA)
gc()

# D_ITCP_ITEM_COMPRA

D_ITCP_ITEM_COMPRA  <- readRDS(paste0(path,"/D_ITCP_ITEM_COMPRA.rds"))
D_ITCP_ITEM_COMPRA  <- convert_to_date(D_ITCP_ITEM_COMPRA)

D_ITCP_ITEM_COMPRA$DS_ITCP_TP_CRITERIO_JULG  <-
  factor(D_ITCP_ITEM_COMPRA$ID_ITCP_TP_CRITERIO_JULG,
         levels = D_ITCP_TP_CRITERIO_JULG$ID_ITCP_TP_CRITERIO_JULG,
         labels = D_ITCP_TP_CRITERIO_JULG$DS_ITCP_TP_CRITERIO_JULG)

D_ITCP_ITEM_COMPRA$DS_ITCP_IN_COMPRA_GRUPO  <-
  factor(D_ITCP_ITEM_COMPRA$ID_ITCP_IN_COMPRA_GRUPO,
         levels = D_ITCP_IN_COMPRA_GRUPO$ID_ITCP_IN_COMPRA_GRUPO,
         labels = D_ITCP_IN_COMPRA_GRUPO$DS_ITCP_IN_COMPRA_GRUPO)

D_ITCP_ITEM_COMPRA$DS_ITCP_IN_DESEMPATE_ME_EPP  <-
  factor(D_ITCP_ITEM_COMPRA$ID_ITCP_IN_DESEMPATE_ME_EPP,
         levels = D_ITCP_IN_DESEMPATE_ME_EPP$ID_ITCP_IN_DESEMPATE_ME_EPP,
         labels = D_ITCP_IN_DESEMPATE_ME_EPP$DS_ITCP_IN_DESEMPATE_ME_EPP)

D_ITCP_ITEM_COMPRA$DS_ITCP_IN_DESEMPATE_7174  <-
  factor(D_ITCP_ITEM_COMPRA$ID_ITCP_IN_DESEMPATE_7174,
         levels = D_ITCP_IN_DESEMPATE_7174$ID_ITCP_IN_DESEMPATE_7174,
         labels = D_ITCP_IN_DESEMPATE_7174$DS_ITCP_IN_DESEMPATE_7174)

D_ITCP_ITEM_COMPRA$DS_ITCP_IN_BENEF_7174  <-
  factor(D_ITCP_ITEM_COMPRA$ID_ITCP_IN_BENEF_7174,
         levels = D_ITCP_IN_BENEF_7174$ID_ITCP_IN_BENEF_7174,
         labels = D_ITCP_IN_BENEF_7174$DS_ITCP_IN_BENEF_7174)

D_ITCP_ITEM_COMPRA$DS_ITCP_IN_PART_ABERTA  <-
  factor(D_ITCP_ITEM_COMPRA$ID_ITCP_IN_PART_ABERTA, 
         levels = D_ITCP_IN_PART_ABERTA$ID_ITCP_IN_PART_ABERTA, 
         labels = D_ITCP_IN_PART_ABERTA$DS_ITCP_IN_PART_ABERTA)

D_ITCP_ITEM_COMPRA$DS_ITCP_IN_PRORR_ATA_SRP  <- 
  factor(D_ITCP_ITEM_COMPRA$ID_ITCP_IN_PRORR_ATA_SRP, 
         levels = D_ITCP_IN_PRORR_ATA_SRP$ID_ITCP_IN_PRORR_ATA_SRP, 
         labels = D_ITCP_IN_PRORR_ATA_SRP$DS_ITCP_IN_PRORR_ATA_SRP)

D_ITCP_ITEM_COMPRA$DS_ITCP_IN_PREF_PROD_NACIONAL  <- 
  factor(D_ITCP_ITEM_COMPRA$ID_ITCP_IN_PREF_PROD_NACIONAL, 
         levels = D_ITCP_IN_PREF_PROD_NACIONAL$ID_ITCP_IN_PREF_PROD_NACIONAL, 
         labels = D_ITCP_IN_PREF_PROD_NACIONAL$DS_ITCP_IN_PREF_PROD_NACIONAL)

D_ITCP_ITEM_COMPRA$DS_ITCP_IN_SUSTENTAVEL  <- 
  factor(D_ITCP_ITEM_COMPRA$ID_ITCP_IN_SUSTENTAVEL, 
         levels = D_ITCP_IN_SUSTENTAVEL$ID_ITCP_IN_SUSTENTAVEL, 
         labels = D_ITCP_IN_SUSTENTAVEL$DS_ITCP_IN_SUSTENTAVEL)

D_ITCP_ITEM_COMPRA$DS_ITCP_IN_PREF_PROD_ADICIONAL  <- 
  factor(D_ITCP_ITEM_COMPRA$ID_ITCP_IN_PREF_PROD_ADICIONAL, 
         levels = D_ITCP_IN_PREF_PROD_ADICIONAL$ID_ITCP_IN_PREF_PROD_ADICIONAL, 
         labels = D_ITCP_IN_PREF_PROD_ADICIONAL$DS_ITCP_IN_PREF_PROD_ADICIONAL)

saveRDS(D_ITCP_ITEM_COMPRA,paste0(newpath,"/D_ITCP_ITEM_COMPRA.rds"))

rm(D_ITCP_ITEM_COMPRA)
gc()

# D_ITFN_ITEM_FORNECEDOR

D_ITFN_ITEM_FORNECEDOR <- readRDS(paste0(path,"/D_ITFN_ITEM_FORNECEDOR.rds"))
D_ITFN_ITEM_FORNECEDOR  <- convert_to_date(D_ITFN_ITEM_FORNECEDOR)

D_ITFN_ITEM_FORNECEDOR$DS_ITFN_IN_ITEM_80000  <-
  factor(D_ITFN_ITEM_FORNECEDOR$ID_ITFN_IN_ITEM_80000,
         levels = D_ITFN_IN_ITEM_80000$ID_ITFN_IN_ITEM_80000,
         labels = D_ITFN_IN_ITEM_80000$DS_ITFN_IN_ITEM_80000)

D_ITFN_ITEM_FORNECEDOR$DS_ITFN_IN_ITEM_ELEVADO  <-
  factor(D_ITFN_ITEM_FORNECEDOR$ID_ITFN_IN_ITEM_ELEVADO,
         levels = D_ITFN_IN_ITEM_ELEVADO$ID_ITFN_IN_ITEM_ELEVADO,
         labels = D_ITFN_IN_ITEM_ELEVADO$DS_ITFN_IN_ITEM_ELEVADO)

D_ITFN_ITEM_FORNECEDOR$DS_ITFN_TP_DECL_BENEF_7174  <-
  factor(D_ITFN_ITEM_FORNECEDOR$ID_ITFN_TP_DECL_BENEF_7174,
         levels = D_ITFN_TP_DECLAR_BENEF_7174$ID_ITFN_TP_DECLAR_BENEF_7174,
         labels = D_ITFN_TP_DECLAR_BENEF_7174$DS_ITFN_TP_DECLAR_BENEF_7174)

D_ITFN_ITEM_FORNECEDOR$DS_ITFN_IN_FORNEC_SUBCONTR  <-
  factor(D_ITFN_ITEM_FORNECEDOR$ID_ITFN_IN_FORNEC_SUBCONTR,
         levels = D_ITFN_IN_SUBCONTRATADA$ID_ITFN_IN_SUBCONTRATADA,
         labels = D_ITFN_IN_SUBCONTRATADA$DS_ITFN_IN_SUBCONTRATADA)

D_ITFN_ITEM_FORNECEDOR$DS_ITFN_IN_PROD_FAB_NACIONAL  <-
  factor(D_ITFN_ITEM_FORNECEDOR$ID_ITFN_IN_PROD_FAB_NACIONAL,
         levels = D_ITFN_IN_PROD_FAB_NACIONAL$ID_ITFN_IN_PROD_FAB_NACIONAL,
         labels = D_ITFN_IN_PROD_FAB_NACIONAL$DS_ITFN_IN_PROD_FAB_NACIONAL)

D_ITFN_ITEM_FORNECEDOR$DS_ITFN_PAIS_FAB_PRODUTO  <-
  factor(D_ITFN_ITEM_FORNECEDOR$ID_ITFN_PAIS_FAB_PRODUTO,
         levels = D_ITFN_PAIS_FAB_PRODUTO$ID_ITFN_PAIS_FAB_PRODUTO,
         labels = D_ITFN_PAIS_FAB_PRODUTO$DS_ITFN_PAIS_FAB_PRODUTO)

saveRDS(D_ITFN_ITEM_FORNECEDOR,paste0(newpath,"/D_ITFN_ITEM_FORNECEDOR.rds"))                                  
rm(D_ITFN_ITEM_FORNECEDOR)
gc()

# F_ITEM_FORNECEDOR

F_ITEM_FORNECEDOR <- readRDS(paste0(path,"/F_ITEM_FORNECEDOR.rds"))
F_ITEM_FORNECEDOR <- convert_to_date(F_ITEM_FORNECEDOR)

F_ITEM_FORNECEDOR$DS_ITFN_CLASSIF_FORNEC  <-
  factor(F_ITEM_FORNECEDOR$ID_ITFN_CLASSIF_FORNEC,
         levels = D_ITFN_CLASSIF_FORNEC$ID_ITFN_CLASSIF_FORNEC,
         labels = D_ITFN_CLASSIF_FORNEC$DS_ITFN_CLASSIF_FORNEC)

F_ITEM_FORNECEDOR$DS_ITCP_SIT_ATUAL_ITEM  <-
  factor(F_ITEM_FORNECEDOR$ID_ITCP_SIT_ATUAL_ITEM,
         levels = D_ITCP_SIT_ATUAL_ITEM$ID_ITCP_SIT_ATUAL_ITEM,
         labels = D_ITCP_SIT_ATUAL_ITEM$DS_ITCP_SIT_ATUAL_ITEM)

F_ITEM_FORNECEDOR$DS_ITFN_SIT_FORNEC_COMPRA  <-
  factor(F_ITEM_FORNECEDOR$ID_ITFN_SIT_FORNEC_COMPRA,
         levels = D_ITFN_SIT_FORNEC_COMPRA$ID_ITFN_SIT_FORNEC_COMPRA,
         labels = D_ITFN_SIT_FORNEC_COMPRA$DS_ITFN_SIT_FORNEC_COMPRA)

F_ITEM_FORNECEDOR <- merge(F_ITEM_FORNECEDOR,D_ITFN_PLACA_INDICADORES,
                           by = "ID_ITFN_PLACA_INDICADORES")

saveRDS(F_ITEM_FORNECEDOR,paste0(newpath,"/F_ITEM_FORNECEDOR.rds"))                                                
rm(F_ITEM_FORNECEDOR)
gc()

# D_UNDD_UNIDADE

D_UNDD_UNIDADE <- readRDS(paste0(path,"/D_UNDD_UNIDADE.rds"))
D_UNDD_UNIDADE <- convert_to_date(D_UNDD_UNIDADE)

str(D_UNDD_UNIDADE[grep('^ID',names(D_UNDD_UNIDADE))])

D_UNDD_UNIDADE$DS_UNDD_ESFERA  <- 
  factor(D_UNDD_UNIDADE$ID_UNDD_ESFERA,
         levels = D_UNDD_ESFERA$ID_UNDD_ESFERA,
         labels = D_UNDD_ESFERA$DS_UNDD_ESFERA)

D_UNDD_UNIDADE$DS_UNDD_IN_UTILIZ_SIAFI  <-
  factor(D_UNDD_UNIDADE$ID_UNDD_IN_UTILIZ_SIAFI,
         levels = D_UNDD_IN_UTILIZ_SIAFI$ID_UNDD_IN_UTILIZ_SIAFI,
         labels = D_UNDD_IN_UTILIZ_SIAFI$DS_UNDD_IN_UTILIZ_SIAFI)

D_UNDD_UNIDADE$DS_UNDD_IN_SISG  <-
  factor(D_UNDD_UNIDADE$ID_UNDD_IN_SISG,
         levels = D_UNDD_IN_SISG$ID_UNDD_IN_SISG,
         labels = D_UNDD_IN_SISG$DS_UNDD_IN_SISG)

D_UNDD_UNIDADE$DS_LCAL_MUNICIPIO_UNIDADE  <-
  factor(D_UNDD_UNIDADE$ID_LCAL_MUNICIPIO_UNIDADE,
         levels = D_LCAL_MUNICIPIO$ID_LCAL_MUNICIPIO,
         labels = D_LCAL_MUNICIPIO$DS_LCAL_MUNICIPIO)

D_UNDD_UNIDADE$DS_LCAL_UF_UNIDADE  <-
  factor(D_UNDD_UNIDADE$ID_LCAL_UF_UNIDADE,
         levels = D_LCAL_UF$ID_LCAL_UF, labels = D_LCAL_UF$DS_LCAL_UF)

D_UNDD_UNIDADE$DS_LCAL_REGIAO_UNIDADE  <- 
  factor(D_UNDD_UNIDADE$ID_LCAL_REGIAO_UNIDADE)

D_UNDD_UNIDADE$DS_UNDD_ORGAO  <- 
  factor(D_UNDD_UNIDADE$ID_UNDD_ORGAO, 
         levels = D_UNDD_ORGAO$ID_UNDD_ORGAO, 
         labels = D_UNDD_ORGAO$DS_UNDD_ORGAO)

D_UNDD_UNIDADE$DS_UNDD_ORGAO_SUP  <- 
  factor(D_UNDD_UNIDADE$ID_UNDD_ORGAO_SUP, 
         levels = D_UNDD_ORGAO$ID_UNDD_ORGAO, 
         labels = D_UNDD_ORGAO$DS_UNDD_ORGAO)

D_UNDD_UNIDADE$DS_UNDD_ORGAO_VINC  <- 
  factor(D_UNDD_UNIDADE$ID_UNDD_ORGAO_VINC, 
         levels = D_UNDD_ORGAO$ID_UNDD_ORGAO, labels = D_UNDD_ORGAO$DS_UNDD_ORGAO)

D_UNDD_UNIDADE$DS_UNDD_PODER  <- 
  factor(D_UNDD_UNIDADE$ID_UNDD_PODER, 
         levels = D_UNDD_PODER$ID_UNDD_PODER, labels = D_UNDD_PODER$DS_UNDD_PODER)

D_UNDD_UNIDADE$DS_UNDD_SIT_ATUAL_UNIDADE  <- 
  factor(D_UNDD_UNIDADE$ID_UNDD_SIT_ATUAL_UNIDADE, 
         levels = D_UNDD_SIT_ATUAL_UNIDADE$ID_UNDD_SIT_ATUAL_UNIDADE, 
         labels = D_UNDD_SIT_ATUAL_UNIDADE$DS_UNDD_SIT_ATUAL_UNIDADE)

D_UNDD_UNIDADE$DS_UNDD_TP_ADM  <- factor(D_UNDD_UNIDADE$ID_UNDD_TP_ADM, 
                                         levels = D_UNDD_TP_ADM$ID_UNDD_TP_ADM, 
                                         labels = D_UNDD_TP_ADM$DS_UNDD_TP_ADM)

D_UNDD_UNIDADE$DS_UNDD_IN_ADESAO_SIASG  <- 
  factor(D_UNDD_UNIDADE$ID_UNDD_IN_ADESAO_SIASG, 
         levels = D_UNDD_IN_ADESAO_SIASG$ID_UNDD_IN_ADESAO_SIASG, 
         labels = D_UNDD_IN_ADESAO_SIASG$DS_UNDD_IN_ADESAO_SIASG)

saveRDS(D_UNDD_UNIDADE,paste0(newpath,"/D_UNDD_UNIDADE.rds"))

rm(D_UNDD_UNIDADE)

# D_ITCP_MATERIAL_SERVICO

D_ITCP_MATERIAL_SERVICO <- readRDS(paste0(path,"/D_ITCP_MATERIAL_SERVICO.rds"))
D_ITCP_MATERIAL_SERVICO <- convert_to_date(D_ITCP_MATERIAL_SERVICO)
                                          
str(D_ITCP_MATERIAL_SERVICO[grep('^ID',names(D_ITCP_MATERIAL_SERVICO))])

D_ITCP_MATERIAL_SERVICO$DS_ITCP_CLASSE_MAT_SERV  <- 
  factor(D_ITCP_MATERIAL_SERVICO$ID_ITCP_CLASSE_MAT_SERV, 
         levels = D_ITCP_CLASSE_MAT_SERV$ID_ITCP_CLASSE_MAT_SERV, 
         labels = D_ITCP_CLASSE_MAT_SERV$DS_ITCP_CLASSE_MAT_SERV)

D_ITCP_MATERIAL_SERVICO$DS_ITCP_PADRAO_DESC_MAT  <- 
  factor(D_ITCP_MATERIAL_SERVICO$ID_ITCP_PADRAO_DESC_MAT, 
         levels = D_ITCP_PADRAO_DESC_MAT$ID_ITCP_PADRAO_DESC_MAT, 
         labels = D_ITCP_PADRAO_DESC_MAT$DS_ITCP_PADRAO_DESC_MAT)

D_ITCP_MATERIAL_SERVICO$DS_ITCP_TP_MATERIAL_SERVICO  <- 
  factor(D_ITCP_MATERIAL_SERVICO$ID_ITCP_TP_MATERIAL_SERVICO, 
         evels = D_ITCP_TP_MATERIAL_SERVICO$ID_ITCP_TP_MATERIAL_SERVICO, 
         labels = D_ITCP_TP_MATERIAL_SERVICO$DS_ITCP_TP_MATERIAL_SERVICO)

D_ITCP_MATERIAL_SERVICO$DS_ITCP_SIT_ATUAL_MAT_SERV  <- 
  factor(D_ITCP_MATERIAL_SERVICO$ID_ITCP_SIT_ATUAL_MAT_SERV, 
         levels = D_ITCP_SIT_ATUAL_MAT_SERV$ID_ITCP_SIT_ATUAL_MAT_SERV, 
         labels = D_ITCP_SIT_ATUAL_MAT_SERV$DS_ITCP_SIT_ATUAL_MAT_SERV)

D_ITCP_MATERIAL_SERVICO$DS_ITCP_GRUPO_MATERIAL  <- 
  factor(D_ITCP_MATERIAL_SERVICO$ID_ITCP_GRUPO_MATERIAL, 
         levels = D_ITCP_GRUPO_MATERIAL$ID_ITCP_GRUPO_MATERIAL, 
         labels = D_ITCP_GRUPO_MATERIAL$DS_ITCP_GRUPO_MATERIAL)

D_ITCP_MATERIAL_SERVICO$DS_ITCP_GRUPO_SERVICO  <- 
  factor(D_ITCP_MATERIAL_SERVICO$ID_ITCP_GRUPO_SERVICO, 
         levels = D_ITCP_GRUPO_SERVICO$ID_ITCP_GRUPO_SERVICO, 
         labels = D_ITCP_GRUPO_SERVICO$DS_ITCP_GRUPO_SERVICO)

D_ITCP_MATERIAL_SERVICO$DS_ITCP_IN_SUSTENTAVEL  <- 
  factor(D_ITCP_MATERIAL_SERVICO$ID_ITCP_IN_SUSTENTAVEL, 
         levels = D_ITCP_IN_SUSTENTAVEL$ID_ITCP_IN_SUSTENTAVEL, 
         labels = D_ITCP_IN_SUSTENTAVEL$DS_ITCP_IN_SUSTENTAVEL)

saveRDS(D_ITCP_MATERIAL_SERVICO,paste0(newpath,"/D_ITCP_MATERIAL_SERVICO.rds"))

D_FRND_FORNECEDOR <- readRDS(paste0(path,"/D_FRND_FORNECEDOR.rds")) 

D_FRND_FORNECEDOR$DS_LCAL_UF_FORNEC  <- 
  factor(D_FRND_FORNECEDOR$ID_LCAL_UF_FORNEC, 
         levels = D_LCAL_UF$ID_LCAL_UF, labels = D_LCAL_UF$DS_LCAL_UF)

D_FRND_FORNECEDOR$DS_LCAL_MUNICIPIO_FORNEC  <- 
  factor(D_FRND_FORNECEDOR$ID_LCAL_MUNICIPIO_FORNEC, 
         levels= D_LCAL_MUNICIPIO$ID_LCAL_MUNICIPIO, 
         labels = D_LCAL_MUNICIPIO$DS_LCAL_MUNICIPIO)

saveRDS(D_FRND_FORNECEDOR,paste0(newpath,"/D_FRND_FORNECEDOR.rds"))